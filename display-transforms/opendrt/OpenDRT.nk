set cut_paste_input [stack 0]
push $cut_paste_input
Group {
 name OpenDRT
 label "\[value display_name]"
 addUserKnob {20 OpenDRT}
 addUserKnob {26 about_label l " " T "<style> a:link \{ color: #ccc \}</style>\n<font color=#ccc>\n<b>OpenDRT</b> <br>v1.1.0b48 | part of <a href=https://github.com/jedypod/open-display-transform>open-display-transform</a><br>"}
 addUserKnob {41 in_gamut l "in gamut" T InGamut_to_XYZ.gamut}
 addUserKnob {26 spacer01 l "" +STARTLINE}
 addUserKnob {35 look_presets l "" t "Select from a list of presets. You can create your own and store them using the Add Preset button. \n\n<b>Arriba</b>: A minimal smooth starting look with natural color rendition and minimal adjustments to create an aesthetically pleasing image. \n\n<b>Sylvan</b>: A smooth starting look with slightly stronger contrast and stronger hue distortions which may be preferential for skin.\n\n<b>Colorful</b>: A low contrast saturated bright look. Might be a good fit for animation.\n\n<b>Aery</b>: A low contrast look with cool highlights and more pure color rendered quite bright. It features strong desaturation near the grey axis, and darkening of only the most pure colors.\n\n<b>Dystopic</b>: A high contrast look with very low saturation and strong filmish hue distortions.\n\n<b>Umbra</b>: A dark moody cinematic look. Features low shadow contrast, warm whites, strong filmic hue distortions, cyan blues, and more saturated colors that render very dark. Works well with a Display Peak Luminance of 200 nits or above.\n\n<b>Base</b>: only the base components of the OpenDRT image rendering. Practically no preferential adjustements. Purity compression is mostly chromaticity-linear and very minimal. Mid-range purity is very strong. A good starting point for further look development if absolute control is required (do not underestimate the complexity of this undertaking)." +STARTLINE M {"Look Presets/Arriba" "knobs this \{tn_con 1.05 tn_sh 0.5 tn_toe 0.1 tn_off 0.013 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 2.0 tn_lcon_w 0.2 cwp 2 cwp_lm 0.25 rs_sa 0.35 rs_rw 0.25 rs_bw 0.55 pt_enable 1 pt_lml 0.25 pt_lml_r 0.25 pt_lml_g 0.0 pt_lml_b 0.1 pt_lmh 0.15 pt_lmh_r 0.15 pt_lmh_b 0.0 ptl_enable 1 ptl_c 0.05 ptl_m 0.08 ptl_y 0.05 ptm_enable 1 ptm_low 0.8 ptm_low_rng 0.4 ptm_low_st 0.5 ptm_high -0.7 ptm_high_rng 0.66 ptm_high_st 0.6 brl_enable 1 brl 0.0 brl_r -3.0 brl_g -3.0 brl_b -3.0 brl_rng 0.5 brl_st 0.35 brlp_enable 1 brlp 0.0 brlp_r -1.7 brlp_g -2.0 brlp_b -0.5 hc_enable 1 hc_r 1.0 hc_r_rng 0.3 hs_rgb_enable 1 hs_r 0.6 hs_r_rng 0.9 hs_g 0.35 hs_g_rng 1.0 hs_b 0.66 hs_b_rng 1.0 hs_cmy_enable 0 hs_c 0.0 hs_c_rng 1.0 hs_m 0.0 hs_m_rng 1.0 hs_y 0.0 hs_y_rng 0.5\}" "Look Presets/Sylvan" "knobs this \{tn_con 1.6 tn_sh 0.5 tn_toe 0.01 tn_off 0.01 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 0.25 tn_lcon_w 0.75 cwp 2 cwp_lm 0.25 rs_sa 0.25 rs_rw 0.25 rs_bw 0.55 pt_enable 1 pt_lml 0.15 pt_lml_r 0.5 pt_lml_g 0.15 pt_lml_b 0.1 pt_lmh 0.25 pt_lmh_r 0.15 pt_lmh_b 0.15 ptl_enable 1 ptl_c 0.05 ptl_m 0.08 ptl_y 0.05 ptm_enable 1 ptm_low 0.5 ptm_low_rng 0.5 ptm_low_st 0.5 ptm_high -0.8 ptm_high_rng 0.5 ptm_high_st 0.5 brl_enable 1 brl -1.0 brl_r -2.0 brl_g -2.0 brl_b 0.0 brl_rng 0.25 brl_st 0.25 brlp_enable 1 brlp -1.0 brlp_r -0.5 brlp_g -0.25 brlp_b -0.25 hc_enable 1 hc_r 1.0 hc_r_rng 0.4 hs_rgb_enable 1 hs_r 0.6 hs_r_rng 1.15 hs_g 0.8 hs_g_rng 1.25 hs_b 0.6 hs_b_rng 1.0 hs_cmy_enable 1 hs_c 0.25 hs_c_rng 0.25 hs_m 0.25 hs_m_rng 0.5 hs_y 0.35 hs_y_rng 0.5\}" "Look Presets/Colorful" "knobs this \{tn_con 1.5 tn_sh 0.5 tn_toe 0.003 tn_off 0.005 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 0.4 tn_lcon_w 0.5 cwp 2 cwp_lm 0.25 rs_sa 0.35 rs_rw 0.25 rs_bw 0.55 pt_enable 1 pt_lml 0.2 pt_lml_r 0.25 pt_lml_g 0.0 pt_lml_b 0.5 pt_lmh 0.25 pt_lmh_r 0.15 pt_lmh_b 0.15 ptl_enable 1 ptl_c 0.05 ptl_m 0.06 ptl_y 0.05 ptm_enable 1 ptm_low 0.8 ptm_low_rng 0.5 ptm_low_st 0.4 ptm_high -0.8 ptm_high_rng 0.4 ptm_high_st 0.4 brl_enable 1 brl 0.0 brl_r -1.25 brl_g -1.25 brl_b -0.25 brl_rng 0.3 brl_st 0.5 brlp_enable 1 brlp -0.5 brlp_r -1.25 brlp_g -1.25 brlp_b 0.0 hc_enable 1 hc_r 1.0 hc_r_rng 0.4 hs_rgb_enable 1 hs_r 0.5 hs_r_rng 1.0 hs_g 0.35 hs_g_rng 1.0 hs_b 0.5 hs_b_rng 1.0 hs_cmy_enable 1 hs_c 0.25 hs_c_rng 1.0 hs_m 0.0 hs_m_rng 1.0 hs_y 0.25 hs_y_rng 1.0\}" "Look Presets/Aery" "knobs this \{tn_con 1.15 tn_sh 0.5 tn_toe 0.04 tn_off 0.006 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 0.0 tn_hcon_st 0.5 tn_lcon_enable 1 tn_lcon 0.5 tn_lcon_w 2.0 cwp 1 cwp_lm 0.25 rs_sa 0.25 rs_rw 0.2 rs_bw 0.5 pt_enable 1 pt_lml 0.0 pt_lml_r 0.35 pt_lml_g 0.15 pt_lml_b 0.1 pt_lmh 0.0 pt_lmh_r 0.5 pt_lmh_b 0.0 ptl_enable 1 ptl_c 0.05 ptl_m 0.08 ptl_y 0.05 ptm_enable 1 ptm_low 0.8 ptm_low_rng 0.35 ptm_low_st 0.5 ptm_high -0.9 ptm_high_rng 0.5 ptm_high_st 0.3 brl_enable 1 brl -3.0 brl_r 0.0 brl_g 0.0 brl_b 1.0 brl_rng 0.8 brl_st 0.15 brlp_enable 1 brlp -1.0 brlp_r -1.0 brlp_g -1.0 brlp_b 0.0 hc_enable 1 hc_r 0.5 hc_r_rng 0.25 hs_rgb_enable 1 hs_r 0.6 hs_r_rng 1.0 hs_g 0.35 hs_g_rng 2.0 hs_b 0.5 hs_b_rng 1.5 hs_cmy_enable 1 hs_c 0.35 hs_c_rng 1.0 hs_m 0.25 hs_m_rng 1.0 hs_y 0.35 hs_y_rng 0.5\}" "Look Presets/Dystopic" "knobs this \{tn_con 1.6 tn_sh 0.5 tn_toe 0.01 tn_off 0.008 tn_hcon_enable 1 tn_hcon 0.25 tn_hcon_pv 0.0 tn_hcon_st 1.0 tn_lcon_enable 1 tn_lcon 1.0 tn_lcon_w 0.75 cwp 2 cwp_lm 0.25 rs_sa 0.35 rs_rw 0.25 rs_bw 0.55 pt_enable 1 pt_lml 0.0 pt_lml_r 0.25 pt_lml_g 0.0 pt_lml_b 0.25 pt_lmh 0.0 pt_lmh_r 0.5 pt_lmh_b 0.0 ptl_enable 1 ptl_c 0.05 ptl_m 0.08 ptl_y 0.05 ptm_enable 1 ptm_low 0.25 ptm_low_rng 0.25 ptm_low_st 0.8 ptm_high -0.8 ptm_high_rng 0.8 ptm_high_st 0.25 brl_enable 1 brl -2.0 brl_r -3.0 brl_g -2.0 brl_b -2.0 brl_rng 0.35 brl_st 0.35 brlp_enable 1 brlp 0.0 brlp_r -1.0 brlp_g -1.0 brlp_b -1.0 hc_enable 1 hc_r 1.0 hc_r_rng 0.25 hs_rgb_enable 1 hs_r 0.7 hs_r_rng 1.33 hs_g 1.0 hs_g_rng 2.0 hs_b 0.75 hs_b_rng 2.0 hs_cmy_enable 1 hs_c 1.0 hs_c_rng 0.5 hs_m 1.0 hs_m_rng 1.0 hs_y 1.0 hs_y_rng 0.765\}" "Look Presets/Umbra" "knobs this \{tn_con 1.8 tn_sh 0.5 tn_toe 0.001 tn_off 0.015 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 1.0 tn_lcon_w 1.0 cwp 5 cwp_lm 0.25 rs_sa 0.35 rs_rw 0.25 rs_bw 0.55 pt_enable 1 pt_lml 0.0 pt_lml_r 0.5 pt_lml_g 0.0 pt_lml_b 0.15 pt_lmh 0.25 pt_lmh_r 0.25 pt_lmh_b 0.0 ptl_enable 1 ptl_c 0.05 ptl_m 0.06 ptl_y 0.05 ptm_enable 1 ptm_low 0.4 ptm_low_rng 0.35 ptm_low_st 0.66 ptm_high -0.5 ptm_high_rng 0.5 ptm_high_st 0.35 brl_enable 1 brl -2.0 brl_r -4.5 brl_g -3.0 brl_b -4.0 brl_rng 0.35 brl_st 0.3 brlp_enable 1 brlp 0.0 brlp_r -2.0 brlp_g -1.0 brlp_b -0.5 hc_enable 1 hc_r 1.0 hc_r_rng 0.35 hs_rgb_enable 1 hs_r 0.66 hs_r_rng 1.0 hs_g 0.5 hs_g_rng 2.0 hs_b 0.85 hs_b_rng 2.0 hs_cmy_enable 1 hs_c 0.0 hs_c_rng 1.0 hs_m 0.25 hs_m_rng 1.0 hs_y 0.66 hs_y_rng 0.66\}" "Look Presets/Base" "knobs this \{tn_con 1.66 tn_sh 0.5 tn_toe 0.003 tn_off 0.005 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 0 tn_lcon 0.0 tn_lcon_w 0.5 cwp 2 cwp_lm 0.25 rs_sa 0.35 rs_rw 0.25 rs_bw 0.55 pt_enable 1 pt_lml 0.5 pt_lml_r 0.5 pt_lml_g 0.15 pt_lml_b 0.15 pt_lmh 0.8 pt_lmh_r 0.5 pt_lmh_b 0.0 ptl_enable 1 ptl_c 0.05 ptl_m 0.06 ptl_y 0.05 ptm_enable 0 ptm_low 0.0 ptm_low_rng 0.5 ptm_low_st 0.5 ptm_high 0.0 ptm_high_rng 0.5 ptm_high_st 0.5 brl_enable 0 brl 0.0 brl_r 0.0 brl_g 0.0 brl_b 0.0 brl_rng 0.5 brl_st 0.35 brlp_enable 1 brlp -0.5 brlp_r -1.6 brlp_g -1.6 brlp_b -0.8 hc_enable 0 hc_r 0.0 hc_r_rng 0.25 hs_rgb_enable 0 hs_r 0.0 hs_r_rng 1.0 hs_g 0.0 hs_g_rng 1.0 hs_b 0.0 hs_b_rng 1.0 hs_cmy_enable 0 hs_c 0.0 hs_c_rng 1.0 hs_m 0.0 hs_m_rng 1.0 hs_y 0.0 hs_y_rng 1.0\}"}}
 addUserKnob {22 add_preset l "Add Preset" t "Add current settings as a preset with the specified name." -STARTLINE T "def get_existing_presets(pk):\n  pdict = \{\}\n  for i in range(pk.numValues()):\n    pdict\[pk.itemName(i)] = pk.commands(i)\n  return pdict\n\n\ndef get_preset_cmd(n):\n  preset_knobs = n\['look_preset_knobs'].getValue().split(' ')\n  preset_cmd = 'knobs this \{'\n  for k_name in preset_knobs:\n    k = n\[k_name]\n    if isinstance(k, nuke.Enumeration_Knob) or isinstance(k, nuke.Boolean_Knob):\n      preset_cmd += (f'\{k_name\} \{int(k.getValue())\} ')\n    else:\n      preset_cmd += (f'\{k_name\} \{k.getValue()\} ')\n  preset_cmd = preset_cmd\[:-1]\n  preset_cmd += '\}'\n  return preset_cmd\n\n\nn = nuke.thisNode()\npreset_knob = n\['look_presets']\npreset_dict = get_existing_presets(preset_knob)\npreset_cmd = get_preset_cmd(n)\npreset_name = nuke.getInput('Enter Preset Name:')\nif preset_name:\n  preset_name = f'Look Presets/\{preset_name\}'\n  if preset_name:\n    if preset_name in preset_dict.keys():\n      if nuke.ask(f'Preset \"\{preset_name\}\" exists. Replace it?'):\n        preset_dict\[preset_name] = preset_cmd\n    else:\n      preset_dict\[preset_name] = preset_cmd\n  preset_knob.setValues(preset_dict)"}
 addUserKnob {22 remove_preset l "Remove Preset" t "Remove selected preset." -STARTLINE T "# Remove selected preset\nn = nuke.thisNode()\npk = n\['look_presets']\npdict = \{\}\nfor i in range(pk.numValues()):\n  pdict\[pk.itemName(i)] = pk.commands(i)\npreset_names = \[p.split('/')\[-1].replace(' ', '\\ ') for p in pdict.keys()]\np = nuke.Panel('Delete Preset')\np.addEnumerationPulldown('preset', ' '.join(preset_names))\nif p.show():\n  selected_preset = p.value('preset')\n  del pdict\[f'Look Presets/\{selected_preset\}']\n  pk.setValues(pdict)"}
 addUserKnob {22 show_dctl l "Show DCTL" t "Show DCTL code for the current settings" -STARTLINE T "n = nuke.thisNode()\n\npreset_knobs = n\['look_preset_knobs'].getValue().split(' ')\n\npresetStr = ''\n\nfor k_name in preset_knobs:\n  k = n\[k_name]\n  k_link = n.knobs()\[k_name]\n\n  kVal = k.getValue()\n  classId = k.ClassID()\n  if classId==4:\n    presetStr += (f'\{k_name\} = \{int(k.getValue())\}, ')\n  elif classId==7:\n    presetStr += (f'\{k_name\} = \{k.getValue()\}f, ')\n  elif classId==6:\n    presetStr += (f'\{k_name\} = \{int(k.getValue())\}, ')\n\npresetStr = f'\{presetStr\[:-2]\};'\nnuke.message(presetStr)"}
 addUserKnob {22 show_dctl_params l "Show DCTL (params and tooltips)" t "Show DCTL code for parameter definitions and tooltips" -STARTLINE T "n = nuke.thisNode()\n\npreset_knobs = n\['look_preset_knobs'].getValue().split(' ')\n\nparamStr = ''\ntooltipStr = ''\n\nfor k_name in preset_knobs:\n  k = n\[k_name]\n  k_link = n.knobs()\[k_name]\n\n  kVal = k.getValue()\n  kMin = k.min()\n  kMax = k.max()\n  if kMin>kMax:\n    _tmp = kMax\n    kMax = kMin\n    kMin = _tmp\n  kLabel = k_link.label()\n  if ';' in kLabel:\n    kLabel = kLabel.split(';')\[-1]\n  classId = k.ClassID()\n  if classId==4:\n    vals = \[v for v in k.values() if v != '']\n    pVals = \[f\"_\{k_name\}\{i\}\" for i in range(len(vals))]\n    paramStr += f'DEFINE_UI_PARAMS(_\{k_name\}, \{kLabel\}, DCTLUI_COMBO_BOX, \{int(kVal)\}, \{\{\{\", \".join(pVals)\}\}\}, \{\{\{\", \".join(vals)\}\}\})\\n'\n  elif classId==7:\n    paramStr += f'DEFINE_UI_PARAMS(_\{k_name\}, \{kLabel\}, DCTLUI_SLIDER_FLOAT, \{kVal\}, \{kMin\}, \{kMax\}, 0.0)\\n'\n  elif classId==6:\n    paramStr += f'DEFINE_UI_PARAMS(_\{k_name\}, \{kLabel\}, DCTLUI_CHECK_BOX, \{int(kVal)\})\\n'\n  \n  tooltipStr += f'DEFINE_UI_TOOLTIP(\{kLabel\}, \"\{k_link.tooltip()\}\")\\n'\n\nnuke.message(paramStr + '\\n\\n\\n' + tooltipStr)"}
 addUserKnob {1 look_preset_knobs l "" t "list of knobs to include in presets" +STARTLINE +INVISIBLE}
 look_preset_knobs "tn_con tn_sh tn_toe tn_off tn_hcon_enable tn_hcon tn_hcon_pv tn_hcon_st tn_lcon_enable tn_lcon tn_lcon_w cwp cwp_lm rs_sa rs_rw rs_bw pt_enable pt_lml pt_lml_r pt_lml_g pt_lml_b pt_lmh pt_lmh_r pt_lmh_b ptl_enable ptl_c ptl_m ptl_y ptm_enable ptm_low ptm_low_rng ptm_low_st ptm_high ptm_high_rng ptm_high_st brl_enable brl brl_r brl_g brl_b brl_rng brl_st brlp_enable brlp brlp_r brlp_g brlp_b hc_enable hc_r hc_r_rng hs_rgb_enable hs_r hs_r_rng hs_g hs_g_rng hs_b hs_b_rng hs_cmy_enable hs_c hs_c_rng hs_m hs_m_rng hs_y hs_y_rng"
 addUserKnob {26 spacer02 l " " T " "}
 addUserKnob {20 grp_outer l "" +STARTLINE n -2}
 addUserKnob {20 grp_tone l Tonescale t "Settings related to the tonescale function."}
 addUserKnob {35 tn_presets l "" t "Presets specifically for the tonescale function. A number of creative options show the possibilities. \n\n<b>Low Contrast</b> A low contrast tonescale curve that is intended as a starting point for further grading. Requires further contrast to be added in order to achieve something resembling a \"finished\" image, unless a very low contrast look is desired.\n\n<b>Medium Contrast</b>: Slightly stronger contrast. Still quite minimal and suitable as a starting point for further grading. Still a good base to build on.\n\n<b>High Contrast</b>: High contrast tonescale curve. Enough contrast to maybe be called a \"finished\" image, but also could be a good base to build on for other types of looks.\n\n<b>Arriba Tonescale</b>: Tonescale curve used in the Arriba look preset. A relatively low-contrast tonescale with a smooth transition into shadows. Uses an approach to the toe more typical of camera style DRTs, where there is a strong positive offset, and strong shadow toe compression.\n\n<b>Sylvan Tonescale</b>: Tonescale curve used in the Sylvan look preset. Slightly higher contrast especially in shadows while still being a good starting point for further grading or look development.\n\n<b>Colorful Tonescale</b>: Tonescale curve used in the Colorful look preset. Similar to the High Contrast tonescale curve with reduced shadow contrast.\n\n<b>Aery Tonescale</b>:  Tonescale curve used in the Aery look preset. A low contrast curve utilizing the Contrast Low module in a different way, pushing the width very high to act more as a highlight contrast control.\n\n<b>Umbra Tonescale</b>: A dark cinematic tonescale preset with deep low contrast shadows and strong midtone contrast. Works well with a 200 nit peak luminance.\n\n<b>ACES 1.x</b>: A rough match of the ACES 1.x tonescale curve. One deviation is mapping 0.0 to 0.0 through the tonescale curve, rather than mapping +0.02 to 0.0... because that is moronic. Also places the peak intersection constraint a bit higher than the original ~16 to be a bit more modern and compatible with modern camera dynamic ranges.\n\n<b>ACES 2.0</b>: An exact match to the ACES 2.0 tonescale function. Very low contrast in the highlights, and very strong shadow toe compression while mapping 0 to 0 through the tonescale function. Be careful with this one if adding additional shadow contrast upstream, without a strong positive offset.\n\n<b>Marvelous Tonescape</b>: A contrasty cinematic tonescale with strong highlight contrast. Similar to ACES 1.x but with reduced shadow contrast and softer rolloff in the highlights. Works well with higher display peak luminance.\n\n<b>DaGrinchi ToneGroan</b>: Another low-contrast tonescale designed as a starting point for further manipulations. Questionable choices make it not as good as other options." +STARTLINE M {"Tonescale Presets/Low Contrast" "knobs this \{tn_con 1.4 tn_sh 0.5 tn_toe 0.003 tn_off 0.005 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 0 tn_lcon 0.0 tn_lcon_w 0.5\}" "Tonescale Presets/Medium Contrast" "knobs this \{tn_con 1.66 tn_sh 0.5 tn_toe 0.003 tn_off 0.005 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 0 tn_lcon 0.0 tn_lcon_w 0.5\}" "Tonescale Presets/High Contrast" "knobs this \{tn_con 1.4 tn_sh 0.5 tn_toe 0.003 tn_off 0.005 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 1.0 tn_lcon_w 0.5\}" "Tonescale Presets/Arriba Tonescale" "knobs this \{tn_con 1.05 tn_sh 0.5 tn_toe 0.1 tn_off 0.013 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 2.0 tn_lcon_w 0.2\}" "Tonescale Presets/Sylvan Tonescale" "knobs this \{tn_con 1.6 tn_sh 0.5 tn_toe 0.01 tn_off 0.01 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 0.25 tn_lcon_w 0.75\}" "Tonescale Presets/Colorful Tonescale" "knobs this \{tn_con 1.5 tn_sh 0.5 tn_toe 0.003 tn_off 0.005 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 0.4 tn_lcon_w 0.5\}" "Tonescale Presets/Aery Tonescale" "knobs this \{tn_con 1.15 tn_sh 0.5 tn_toe 0.04 tn_off 0.006 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 0.0 tn_hcon_st 0.5 tn_lcon_enable 1 tn_lcon 0.5 tn_lcon_w 2.0\}" "Tonescale Presets/Dystopic Tonescale" "knobs this \{tn_con 1.6 tn_sh 0.5 tn_toe 0.01 tn_off 0.008 tn_hcon_enable 1 tn_hcon 0.25 tn_hcon_pv 0.0 tn_hcon_st 1.0 tn_lcon_enable 1 tn_lcon 1.0 tn_lcon_w 0.75\}" "Tonescale Presets/Umbra Tonescale" "knobs this \{tn_con 1.8 tn_sh 0.5 tn_toe 0.001 tn_off 0.015 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 1.0 tn_lcon_w 1.0\}" "Tonescale Presets/ACES-1.x" "knobs this \{tn_con 1.0 tn_sh 0.35 tn_toe 0.02 tn_off 0.0 tn_hcon_enable 1 tn_hcon 0.55 tn_hcon_pv 0.0 tn_hcon_st 2.0 tn_lcon_enable 1 tn_lcon 1.13 tn_lcon_w 1.0\}" "Tonescale Presets/ACES-2.0" "knobs this \{ tn_con 1.15 tn_sh 0.5 tn_toe 0.04 tn_off 0.0 tn_hcon_enable 0 tn_hcon 1.0 tn_hcon_pv 1.0 tn_hcon_st 1.0 tn_lcon_enable 0 tn_lcon 1.0 tn_lcon_w 0.6\}" "Tonescale Presets/Marvelous Tonescape" "knobs this \{tn_con 1.5 tn_sh 0.5 tn_toe 0.003 tn_off 0.01 tn_hcon_enable 1 tn_hcon 0.25 tn_hcon_pv 0.0 tn_hcon_st 4.0 tn_lcon_enable 1 tn_lcon 1.0 tn_lcon_w 1.0\}" "Tonescale Presets/DaGrinchi Tonegroan" "knobs this \{tn_con 1.2 tn_sh 0.5 tn_toe 0.02 tn_off 0.0 tn_hcon_enable 0 tn_hcon 0.0 tn_hcon_pv 1.0 tn_hcon_st 1.0 tn_lcon_enable 0 tn_lcon 0.0 tn_lcon_w 0.6\}"}}
 addUserKnob {22 tn_add_preset l "Add Preset" t "Click to add current settings as a preset with a specified name." -STARTLINE T "def get_existing_presets(pk):\n  pdict = \{\}\n  for i in range(pk.numValues()):\n    pdict\[pk.itemName(i)] = pk.commands(i)\n  return pdict\n\n\ndef get_preset_cmd(n):\n  preset_knobs = n\['tn_preset_knobs'].getValue().split(' ')\n  preset_cmd = 'knobs this \{'\n  for k_name in preset_knobs:\n    k = n\[k_name]\n    if isinstance(k, nuke.Enumeration_Knob) or isinstance(k, nuke.Boolean_Knob):\n      preset_cmd += (f'\{k_name\} \{int(k.getValue())\} ')\n    else:\n      preset_cmd += (f'\{k_name\} \{k.getValue()\} ')\n  preset_cmd = preset_cmd\[:-1]\n  preset_cmd += '\}'\n  return preset_cmd\n\n\nn = nuke.thisNode()\npreset_knob = n\['tn_presets']\npreset_dict = get_existing_presets(preset_knob)\npreset_cmd = get_preset_cmd(n)\npreset_name = nuke.getInput('Enter Preset Name:')\nif preset_name:\n  preset_name = f'Tonescale Presets/\{preset_name\}'\n  if preset_name:\n    if preset_name in preset_dict.keys():\n      if nuke.ask(f'Preset \"\{preset_name\}\" exists. Replace it?'):\n        preset_dict\[preset_name] = preset_cmd\n    else:\n      preset_dict\[preset_name] = preset_cmd\n  preset_knob.setValues(preset_dict)"}
 addUserKnob {22 tn_remove_preset l "Remove Preset" t "Remove selected preset." -STARTLINE T "# Remove selected preset\nn = nuke.thisNode()\npk = n\['tn_presets']\npdict = \{\}\nfor i in range(pk.numValues()):\n  pdict\[pk.itemName(i)] = pk.commands(i)\npreset_names = \[p.split('/')\[-1].replace(' ', '\\ ') for p in pdict.keys()]\np = nuke.Panel('Delete Preset')\np.addEnumerationPulldown('preset', ' '.join(preset_names))\nif p.show():\n  selected_preset = p.value('preset')\n  del pdict\[f'Tonescale Presets/\{selected_preset\}']\n  pk.setValues(pdict)"}
 addUserKnob {22 tn_show_dctl l "Show DCTL" t "Show DCTL code for the current settings" -STARTLINE T "n = nuke.thisNode()\n\npreset_knobs = n\['tn_preset_knobs'].getValue().split(' ')\n\ndctl_str = ''\nfor k_name in preset_knobs:\n    k = n\[k_name]\n    if isinstance(k, nuke.Enumeration_Knob) or isinstance(k, nuke.Boolean_Knob):\n        dctl_str += (f'\{k_name\} = \{int(k.getValue())\}, ')\n    else:\n        dctl_str += (f'\{k_name\} = \{k.getValue()\}f, ')\n\ndctl_str = f'\{dctl_str\[:-2]\};'\nnuke.message(dctl_str)"}
 addUserKnob {1 tn_preset_knobs l "" t "list of knobs to include in presets" +STARTLINE +HIDDEN}
 tn_preset_knobs "tn_con tn_sh tn_toe tn_off tn_hcon_enable tn_hcon tn_hcon_pv tn_hcon_st tn_lcon_enable tn_lcon tn_lcon_w"
 addUserKnob {26 spacer04 l "" +STARTLINE}
 addUserKnob {26 lbl_ts l " " T "<b>Tonescale Parameters"}
 addUserKnob {41 tn_Lp l "Display Peak Luminance" t "Peak display luminance in nits. In SDR, the max value stays pinned at 1.0. In HDR, the max value is adjusted to match peak luminance in the HDR container." T TONESCALE_CTRL.tn_Lp}
 addUserKnob {41 tn_gb l "HDR Grey Boost" t "Amount of stops to boost Grey Luminance, per stop of exposure increase of Peak Luminance. For example, if HDR Grey Boost is 0.1, middle grey will be boosted by 0.1 stops per stop of Peak Luminance increase." T TONESCALE_CTRL.tn_gb}
 addUserKnob {41 pt_hdr l "HDR Purity" t "How much to affect purity compression and hue shift as Peak Luminance increases. A value of 0.0 will keep the purity compression and hue shift behavior the same for SDR and HDR. A value of 1.0 will preserve more purity as peak luminance increases (at the risk of gradient disruptions in high purity high intensity light sources), and will reduce hue shift amount in highlights." T TONESCALE_CTRL.pt_hdr}
 addUserKnob {41 tn_Lg l "Display Grey Luminance" t "Display luminance for middle grey (0.18) in nits. Sets the target value for middle grey within the available luminance range of the display device." T TONESCALE_CTRL.tn_Lg}
 addUserKnob {41 tn_con l Contrast t "Adjusts contrast or slope. A constrained power function applied in display linear." T TONESCALE_CTRL.tn_con}
 addUserKnob {41 tn_sh l "Shoulder Clip" t "Unitless control for the scene-linear value at which the tonescale system crosses the peak display linear value (1.0) and clips. This is not an exact constraint in order to keep the system simple, but corresponds to roughly 16 at Shoulder Clip = 0 and 1024 at Shoulder Clip = 1" T TONESCALE_CTRL.tn_sh}
 addUserKnob {41 tn_toe l Toe t "Quadratic toe compression. Strongly compresses deep shadows. Helpful to have some amount to smooth the transition into display minimum. Higher values with a strong positive Offset also valid. Similar to common camera DRT tonescale strategies." T TONESCALE_CTRL.tn_toe}
 addUserKnob {41 tn_off l Offset t "Pre-tonescale scene-linear offset. If 0.0, scene-linear 0.0 maps to display-linear 0.0 through the tonescale system. Many camera imaging pipelines apply a negative offset to set the average of shadow grain at 0.0. A positive Offset can be desireable to compensate for this and increase detail in shadows, in addition to being aesthetically desireable. Offset should NOT be a negative number (Looking at you ACES 1.x)" T TONESCALE_CTRL.tn_off}
 addUserKnob {26 ""}
 addUserKnob {6 tn_hcon_enable l "<b>&nbsp;Enable Contrast High" t "Contrast High allows control of the upper section of the tonescale function. Off by default, but can be useful if a stronger highlight contrast, or a softer highlight rolloff behavior is desired." +STARTLINE}
 addUserKnob {41 tn_hcon l "Contrast High" t "Amount adjust highlights. Positive values increase highlight exposure, negative values decrease. 0 has no effect." T ContrastHigh.tn_hcon}
 addUserKnob {41 tn_hcon_pv l "Contrast High Pivot" t "Amount of stops above middle grey (0.18) to start the adjustment." T ContrastHigh.pv}
 addUserKnob {41 tn_hcon_st l "Contrast High Strength" t "How quickly above the Contrast High Pivot the effect begins." T ContrastHigh.pv_lx}
 addUserKnob {6 tn_lcon_enable l "<b>&nbsp;Enable Contrast Low" t "Contrast Low adds contrast to the midtones and shadows. Middle grey (0.18) is un-changed through the adjustment." +STARTLINE}
 tn_lcon_enable true
 addUserKnob {41 tn_lcon l "Contrast Low" t "Amount of contrast to add. 0.0 has no effect. 1.0 will expose down by 1 stop at the origin (0,0)" T ContrastLow.tn_lcon}
 addUserKnob {41 tn_lcon_w l "Contrast Low Width" t "The width of the adjustment. Width below 0.5 will mostly affect values between 0 and middle grey. Values above 0.5 will increasingly start to increase highlight contrast, which could be desired or not depending on what you are trying to do." T ContrastLow.tn_lcon_w}
 addUserKnob {26 ""}
 addUserKnob {41 cwp l "Creative White" t "Set the creative whitepoint of the display peak luminance. With D65 all channels are equal. With D50, the peak luminance value will match a D50 whitepoint. This can be creatively desireable. This adjustment is applied post-tonescale." T DisplayGamut.cwp}
 addUserKnob {41 cwp_lm l "Creative White Limit" t "Limit the intensity range affected by the Creative Whitepoint. At 0.0, the entire intensity range is affected. As the limit is decreased, more of midtones and shadows are kept neutral. It can be creatively desireable to keep midtones more neutral while shifting highlights warmer for example." T DisplayGamut.p}
 addUserKnob {41 tn_su l Surround t "Surround illumination conditions:\ndark: theater dark surround\ndim: video 5 nits surround\nbright: brighter office living room surround conditions" T TONESCALE_CTRL.tn_su}
 addUserKnob {20 grp_purity l Purity}
 addUserKnob {26 lbl_rs l " " T "<b>Render Space"}
 addUserKnob {41 rs_sa l "Render Space Strength" t "Render space is the encoding in which the RGB Ratios are taken. Strength controls how much to desaturate from P3 gamut. Creatively, the more you desaturate, the more brilliance is increased in the resulting image. To be used with caution as this affects every other aspect of the image rendering." T SatW.s}
 addUserKnob {41 rs_rw l "Render Space Weight R" t "The Red weight of the Render Space Strength. Modify with caution as this affects every other part of the image rendering." T SatW.rw}
 addUserKnob {41 rs_bw l "Render Space Weight B" t "The Blue weight of the Render Space Strength. Modify with caution as this affects every other part of the image rendering." T SatW.bw}
 addUserKnob {6 pt_enable l "<b>&nbsp;Enable Purity Compress High" t "Compresses purity as intensity increases. Bare minimum functionality for a picture formation." +STARTLINE}
 pt_enable true
 addUserKnob {41 pt_lml l "Purity Limit Low" t "Limit the strength of purity compression as intensity decreases, for all hue angles. A higher value will compress purity less in midtones and shadows." T PurityLimitLow.p}
 addUserKnob {41 pt_lml_r l "Purity Limit Low R" t "Limit the strength of purity compression as intensity decreases, for reds. A higher value will compress purity less in midtones and shadows." T PurityLimitLow.p0}
 addUserKnob {41 pt_lml_g l "Purity Limit Low G" t "Limit the strength of purity compression as intensity decreases, for all greens. A higher value will compress purity less in midtones and shadows." T PurityLimitLow.p1}
 addUserKnob {41 pt_lml_b l "Purity Limit Low B" t "Limit the strength of purity compression as intensity decreases, for blues. A higher value will compress purity less in midtones and shadows." T PurityLimitLow.p2}
 addUserKnob {41 pt_lmh l "Purity Limit High" t "Limit the strength of purity compression as intensity increases. Can be helpful to keep some color in high intensity high purity light sources. Use with caution as this can cause gradient disruptions." T PurityLimitHigh.p}
 addUserKnob {41 pt_lmh_r l "Purity Limit High R" t "Limit the strength of red purity compression as intensity increases. Can be helpful to keep some color in high intensity fire and pure red light sources. Use with caution as this can cause gradient disruptions." T PurityLimitHigh.p0}
 addUserKnob {41 pt_lmh_b l "Purity Limit High B" t "Limit the strength of blue purity compression as intensity increases. Can be helpful to keep some color in high intensity pure blue light sources. Use with caution as this can cause gradient disruptions." T PurityLimitHigh.p1}
 addUserKnob {26 ""}
 addUserKnob {6 ptl_enable l "<b>&nbsp;Enable Purity Softclip" t "Purity Softclip increases tonality and smoothness in extremely pure input values that can not be adequately compressed into the display-referred gamut volume. The algorithm is tuned for common camera observer colorimetry sources." +STARTLINE}
 ptl_enable true
 addUserKnob {41 ptl_c l "Purity Softclip C" t "Purity Softclip strength for Cyan." T SoftplusRGB.s0}
 addUserKnob {41 ptl_m l "Purity Softclip M" t "Purity Softclip strength for Magenta." T SoftplusRGB.s1}
 addUserKnob {41 ptl_y l "Purity Softclip Y" t "Purity Softclip strength for Yellow." T SoftplusRGB.s2}
 addUserKnob {26 ""}
 addUserKnob {6 ptm_enable l "<b>&nbsp;Enable Mid Purity" t "The Mid Purity module adjusts mid-range purity of midtones and highlights. Without this module enabled, it is likely that midtones will not appear colorful enough, and highlights will appear too colorful resulting in chaulky pasty looking images especially in yellows and cyans. " +STARTLINE}
 ptm_enable true
 addUserKnob {41 ptm_low l "Mid Purity Low" t "Amount to increase purity of midtones and shadows in mid-range purity areas. A value of 0.0 will have no effect. A value of 1.0 is the maximum possible value while preserving smoothness." T MidPurity.s0}
 addUserKnob {41 ptm_low_rng l "Mid Purity Low Range" t "The strength of the Mid Purity Low adjustment. Higher values affect more of the luminance range." T MidPurity.p0}
 addUserKnob {41 ptm_low_st l "Mid Purity Low Strength" t "The strength of the Mid Purity Low adjustment. Higher values affect more of the purity range." T MidPurity.w0}
 addUserKnob {41 ptm_high l "Mid Purity High" t "Amount to decrease purity of upper midtones and highlights in mid-range purity areas. A value of 0.0 will have no effect. A value of 1.0 is the maximum possible value while preserving smoothness." T MidPurity.s1}
 addUserKnob {41 ptm_high_rng l "Mid Purity High Range" t "The strength of the Mid Purity High adjustment. Higher values affect more of the luminance range." T MidPurity.p1}
 addUserKnob {41 ptm_high_st l "Mid Purity High Strength" t "The strength of the Mid Purity High adjustment. Higher values affect more of the purity range." T MidPurity.w1}
 addUserKnob {20 grp_br l Brilliance}
 addUserKnob {6 brl_enable l "<b>&nbsp;Enable Brilliance" t "Brilliance scales the intensity of more pure stimuli. The brilliance module is applied before the tonescale is taken for purity compression. This means that if you darken reds with this adjustment, the purity compression will also be reduced. This behavior is natural and smooth." +STARTLINE}
 brl_enable true
 addUserKnob {41 brl l Brilliance t "Global intensity scale of high-purity stimuli." T Brilliance.m}
 addUserKnob {41 brl_r l "Brilliance R" t "Scale intensity of high-purity reds." T Brilliance.m0}
 addUserKnob {41 brl_g l "Brilliance G" t "Scale intensity of high-purity greens." T Brilliance.m1}
 addUserKnob {41 brl_b l "Brilliance B" t "Scale intensity of high-purity blues." T Brilliance.m2}
 addUserKnob {41 brl_rng l "Brilliance Range" t "As Brilliance Range is increased, the brilliance adjustments affect more the low intensity values of the image data." T Brilliance.p0}
 addUserKnob {41 brl_st l "Brilliance Strength" t "As Brilliance Strength is increased, the brilliance adjustments affect more the low purity values of the image data." T Brilliance.w0}
 addUserKnob {26 ""}
 addUserKnob {6 brlp_enable l "<b>&nbsp;Enable Post Brilliance" t "Post Brilliance scales the intensity of more pure stimuli after purity compression hue shifts have been applied. With the OpenDRT algorithm it is possible to get high intensity high purity values going out of the top of the display-referred gamut volume, which can cause discontinuities in gradients, especially on the RGB primaries. This module can help compensate for this." +STARTLINE}
 brlp_enable true
 addUserKnob {41 brlp l "Brilliance Post" t "Global post purity compression brilliance adjustment " T BrilliancePost.m}
 addUserKnob {41 brlp_r l "Post Brilliance R" t "Scale intensity of high-purity red, post purity compression. This can help reduce rings or halos around high purity light sources." T BrilliancePost.m0}
 addUserKnob {41 brlp_g l "Post Brilliance G" t "Scale intensity of high-purity green, post purity compression. This can help reduce rings or halos around high purity light sources." T BrilliancePost.m1}
 addUserKnob {41 brlp_b l "Post Brilliance B" t "Scale intensity of high-purity blue, post purity compression. This can help reduce rings or halos around high purity light sources." T BrilliancePost.m2}
 addUserKnob {26 ""}
 addUserKnob {20 grp_hueshift l "Hue Shift"}
 addUserKnob {6 hc_enable l "<b>&nbsp;Enable Hue Contrast" t "Hue Contrast compresses hue angle towards the primary at the bottom end and expands the hue angle towards the secondary as intensity increases. It also increases purity as it compresses, and decreases purity as it expands. This leads to a nice creatively controllable simulation of this effect from per-channel tonescales. For OpenDRT we only keep the red hue angle control since it is the most useful." +STARTLINE}
 hc_enable true
 addUserKnob {41 hc_r l "Hue Contrast R" t "Amount to increase Hue Contrast at the red hue angle." T HueContrastR.m0}
 addUserKnob {41 hc_r_rng l "Hue Contrast R Range" t "Hue contrast range control: determines where over the intensity range the hue contrast affects. Higher values place the crossover point higher in the intensity range." T HueContrastStrength.p}
 addUserKnob {6 hs_rgb_enable l "<b>&nbsp;Enable Hueshift RGB" t "Hue Shift RGB adds hue distortion to the red green and blue primary hue angles as intensity increases. By default OpenDRT will compress purity in a straight line in RGB/Chromaticity space. This can lead to perceived hue shifts due to the Abney Effect, for example a pure blue will perceptually shift towards purple as it desaturates. To compensate for this, and to use as a creative tool, this module allows creative control over the path that red green and blue hue angles take as their purity is compressed." +STARTLINE}
 hs_rgb_enable true
 addUserKnob {41 hs_r l "Hueshift R" t "Amount to distort the red hue angle towards yellow as intensity increases." T HueShiftOGB.m0}
 addUserKnob {41 hs_r_rng l "Hueshift R Range" t "Range of the red hueshift: higher values affect more of the lower intensity range." T HueShiftOGB.p0}
 addUserKnob {41 hs_g l "Hueshift G" t "Amount to distort the green hue angle towards yellow as intensity increases." T HueShiftOGB.m1}
 addUserKnob {41 hs_g_rng l "Hueshift G Range" t "Range of the green hueshift: higher values affect more of the lower intensity range." T HueShiftOGB.p1}
 addUserKnob {41 hs_b l "Hueshift B" t "Amount to distort the blue hue angle towards cyan as intensity increases." T HueShiftOGB.m2}
 addUserKnob {41 hs_b_rng l "Hueshift B Range" t "Range of the blue hueshift: higher values affect more of the lower intensity range." T HueShiftOGB.p2}
 addUserKnob {26 ""}
 addUserKnob {6 hs_cmy_enable l "<b>&nbsp;Enable Hueshift CMY" t "Hue Shift CMY adds hue distortion to the cyan magenta and yellow secondary hue angles as intensity decreases. This module allows some very minimal adjustments of secondary hue angles as a creative tool." +STARTLINE}
 hs_cmy_enable true
 addUserKnob {41 hs_c l "Hueshift C" t "Amount to distort the cyan hue angle towards blue as intensity decreases." T HueShiftCMY.m0}
 addUserKnob {41 hs_c_rng l "Hueshift C Range" t "Range of the cyan hueshift: higher values affect more of the upper intensity range." T HueShiftCMY.p0}
 addUserKnob {41 hs_m l "Hueshift M" t "Amount to distort the magenta hue angle towards blue as intensity decreases." T HueShiftCMY.m1}
 addUserKnob {41 hs_m_rng l "Hueshift M Range" t "Range of the magenta hueshift: higher values affect more of the upper intensity range." T HueShiftCMY.p1}
 addUserKnob {41 hs_y l "Hueshift Y" t "Amount to distort the yellow hue angle towards red as intensity decreases." T HueShiftCMY.m2}
 addUserKnob {41 hs_y_rng l "Hueshift Y Range" t "Range of the yellow hueshift: higher values affect more of the upper intensity range." T HueShiftCMY.p2}
 addUserKnob {20 endGroup n -4}
 addUserKnob {26 display_encoding_label l " " T "<b>Display Encoding</b>"}
 addUserKnob {35 display_presets l "" -STARTLINE M {"Presets/Rec.1886 - 2.4 Power / Rec.709" "knobs this \{eotf 2 display_gamut 0 tn_Lp 100 tn_su 1 clamp 1 display_name \"Rec.1886 - 2.4 Power / Rec.709\"\}" "Presets/sRGB Display - 2.2 Power / Rec.709" "knobs this \{eotf 1 display_gamut 0 tn_Lp 100 tn_su 2 clamp 1 display_name \"sRGB Display - 2.2 Power / Rec.709\"\}" "Presets/Display P3 - 2.2 Power / P3-D65" "knobs this \{eotf 1 display_gamut 1 tn_Lp 100 tn_su 2 clamp 1 display_name \"Display P3 - 2.2 Power / P3-D65\"\}" "Presets/DCI - 2.6 Power / P3-D60" "knobs this \{eotf 3 display_gamut 3 tn_Lp 100 tn_su 0 clamp 1 display_name \"DCI - 2.6 Power / P3-D60\"\}" "Presets/DCI - 2.6 Power / P3-DCI" "knobs this \{eotf 3 display_gamut 4 tn_Lp 100 tn_su 0 clamp 1 display_name \"DCI - 2.6 Power / P3-DCI\"\}" "Presets/DCI - 2.6 Power / X'Y'Z'" "knobs this \{eotf 3 display_gamut 5 tn_Lp 100 tn_su 0 clamp 1 display_name \"DCDM - 2.6 Power / X'Y'Z'\"\}" "Presets/Rec.2100 - PQ Rec.2020 (P3 Limited)" "knobs this \{eotf 4 display_gamut 2 tn_Lp 1000 tn_su 0 clamp 1 display_name \"Rec.2100 - PQ Rec.2020 (P3 Limited)\"\}" "Presets/Rec.2100 - HLG Rec.2020 (P3 Limited)" "knobs this \{eotf 5 display_gamut 2 tn_Lp 1000 tn_su 0 clamp 1 display_name \"Rec.2100 - HLG Rec.2020 (P3 Limited)\"\}" "Presets/Dolby - PQ P3-D65" "knobs this \{eotf 4 display_gamut 1 tn_Lp 1000 tn_su 0 clamp 1 display_name \"Dolby - PQ 1000nits / P3-D65\"\}"}}
 addUserKnob {1 display_name l " "}
 display_name "Rec.1886 - 2.4 Power / Rec.709"
 addUserKnob {41 eotf t "The Inverse EOTF to use for display encoding." T InverseEOTF.eotf}
 addUserKnob {41 display_gamut l gamut t "The gamut of the target display device." -STARTLINE T DisplayGamut.gamut}
 addUserKnob {6 clamp t "Clamp the final image into the final range supported by the display device." +STARTLINE}
 clamp true
}
 Input {
  inputs 0
  name Input
  xpos 290
  ypos -1257
 }
 Group {
  name InGamut_to_XYZ
  tile_color 0x429940ff
  xpos 290
  ypos -1214
  addUserKnob {20 InputGamutn_to_XYZ_tab l InputGamutn_to_XYZ}
  addUserKnob {4 gamut l "in gamut" M {ACES ACEScg P3D65 Rec.2020 Rec.709 "Arri WideGamut 3" "Arri WideGamut 4" "Red WideGamutRGB" "Sony SGamut3" "Filmlight E-Gamut" "Filmlight E-Gamut2" "DaVinci Wide Gamut"}}
  gamut "Filmlight E-Gamut"
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -610
  }
  Dot {
   name Dot1
   xpos 324
   ypos -534
  }
set N5d808140 [stack 0]
  ColorMatrix {
   matrix {
        {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
        {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
        {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
   }
   name ColorMatrix
   xpos 290
   ypos -370
  }
  Output {
   name Output
   xpos 290
   ypos -250
  }
push $N5d808140
  Dot {
   name Dot391
   label " *RGB to XYZ D65 CAT: XYZ Scaling"
   xpos 434
   ypos -534
  }
set N539c90 [stack 0]
  ColorMatrix {
   matrix {
        {0.7006223202 0.1487748027 0.101058729}
        {0.2741184831 0.8736317754 -0.1477504224}
        {-0.09896290302 -0.1378953159 1.325916052}
   }
   name ColorMatrix30
   label "DaVinci WG to XYZ D65"
   xpos 1610
   ypos -473
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.7364777002 0.1307396511 0.08323857578}
        {0.2750699844 0.8280177902 -0.1030877746}
        {-0.1242251542 -0.08715976739 1.300442672}
   }
   name ColorMatrix169
   label "Filmlight E-Gamut2 to XYZ D65"
   xpos 1500
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.705396831 0.1640413404 0.08101775497}
        {0.2801307142 0.8202067018 -0.1003373787}
        {-0.1037815139 -0.07290726155 1.265746593}
   }
   name ColorMatrix29
   label "Filmlight E-Gamut to XYZ D65"
   xpos 1390
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.5990839005 0.2489254922 0.1024464965}
        {0.2150758207 0.8850684166 -0.1001443192}
        {-0.03206584975 -0.02765838802 1.148782015}
   }
   name ColorMatrix31
   label "SonySGamut3 to XYZ D65"
   xpos 1280
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.735275209 0.06860940903 0.1465712786}
        {0.2866940796 0.8429790735 -0.1296732426}
        {-0.07968084514 -0.3473432064 1.516081929}
   }
   name ColorMatrix22
   label "REDWideGamutRGB to XYZ D65"
   xpos 1170
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.7048583204 0.1297602952 0.1158373115}
        {0.2545241764 0.7814777327 -0.03600190912}
        {0 0 1.089057751}
   }
   name ColorMatrix170
   label "Arri Wide Gamut 4 to XYZ D65"
   xpos 1060
   ypos -471
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.6380076408 0.2147038132 0.09774445742}
        {0.2919537723 0.8238408566 -0.1157948226}
        {0.002798279049 -0.06703422219 1.153293848}
   }
   name ColorMatrix21
   label "Arri AlexaWideGamut to XYZ D65"
   xpos 950
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.4123909175 0.3575843573 0.1804807931}
        {0.2126390785 0.7151687145 0.07219231129}
        {0.01933082566 0.1191947833 0.9505321383}
   }
   name ColorMatrix18
   label "Rec709 to XYZ D65"
   xpos 840
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.6369581223 0.1446169168 0.1688809693}
        {0.2627002299 0.6779981256 0.05930171534}
        {4.99410725e-17 0.02807269618 1.060985088}
   }
   name ColorMatrix17
   label "Rec2020 to XYZ D65"
   xpos 730
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.4865711331 0.2656677067 0.1982173175}
        {0.2289746404 0.6917386055 0.07928691804}
        {-3.972076965e-17 0.04511338845 1.043944478}
   }
   name ColorMatrix16
   label "P3D65 to XYZ D65"
   xpos 620
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.6609312296 0.1336961389 0.1558285803}
        {0.2722287476 0.6740817428 0.05368950963}
        {-0.006018006243 0.004383686464 1.090692043}
   }
   name ColorMatrix1
   label "ACEScg to XYZ D65"
   xpos 510
   ypos -472
  }
push $N539c90
  ColorMatrix {
   matrix {
        {0.9503623843 0 9.346324805e-05}
        {0.3439664543 0.728166163 -0.07213254273}
        {0 0 1.089057803}
   }
   name ColorMatrix2
   label "ACES to XYZ D65"
   xpos 400
   ypos -472
  }
  Switch {
   inputs 12
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -370
  }
 end_group
 ColorMatrix {
  matrix {
       {2.493496912 -0.9313836179 -0.4027107845}
       {-0.8294889696 1.76266406 0.02362468584}
       {0.03584583024 -0.07617238927 0.956884524}
  }
  name ColorMatrix
  label "XYZ D65 to P3D65"
  xpos 290
  ypos -1180
 }
 Expression {
  temp_name3 L
  temp_expr3 r*rw+g*gw+b*bw
  expr0 L*s+r*(1-s)
  expr1 L*s+g*(1-s)
  expr2 L*s+b*(1-s)
  name SatW
  xpos 290
  ypos -1137
  addUserKnob {20 Params}
  addUserKnob {7 s l "color contrast" R 0 0.6}
  s 0.35
  addUserKnob {7 rw l "weight R" R 0 0.8}
  rw 0.25
  addUserKnob {7 gw}
  gw {{1-(rw+bw)}}
  addUserKnob {7 bw l "weight B" R 0 0.8}
  bw 0.55
  addUserKnob {6 invert +STARTLINE}
 }
 Expression {
  expr0 r+off
  expr1 g+off
  expr2 b+off
  name Offset
  xpos 290
  ypos -1105
  addUserKnob {20 Params}
  addUserKnob {7 off l offset R 0 0.01}
  off {{parent.TONESCALE_CTRL.tn_off}}
 }
 Dot {
  name Dot423
  xpos 324
  ypos -990
 }
set N87c53d0 [stack 0]
 Dot {
  name Dot433
  xpos -446
  ypos -990
 }
 Expression {
  channel0 rgba
  expr0 sqrt(max(0,r*r+g*g+b*b))/sqrt(3)
  channel1 {-rgba.red rgba.green -rgba.blue none}
  channel2 {-rgba.red -rgba.green rgba.blue none}
  name Norm
  xpos -480
  ypos -963
 }
 Dot {
  name TONESCALE_CTRL
  tile_color 0x1f7700ff
  label "<b> TONESCALE</b> model\nhttps://www.desmos.com/calculator/aiicar4tjh"
  note_font "Nimbus Sans \[UKWN]"
  note_font_size 12
  xpos -446
  ypos -942
  addUserKnob {20 Params}
  addUserKnob {7 tn_Lp l "peak luminance" R 100 1000}
  tn_Lp 100
  addUserKnob {7 tn_Lg l "grey luminance" R 25 3}
  tn_Lg 10
  addUserKnob {7 tn_gb l "grey boost"}
  tn_gb 0.13
  addUserKnob {7 tn_con l contrast R 1 2}
  tn_con 1.05
  addUserKnob {7 tn_sh l shoulder}
  tn_sh 0.5
  addUserKnob {7 tn_toe l toe R 0 0.1}
  tn_toe 0.1
  addUserKnob {7 tn_off l offset R 0 0.02}
  tn_off 0.013
  addUserKnob {4 tn_su l surround t "Surround illumination compensation:\ndark: darkened theater environment\ndim: 5 nits ambient surround\nbright: brighter office / living room surround" M {dark dim bright ""}}
  tn_su dim
  addUserKnob {7 p R 0 4}
  p {{tn_con/(1+tn_su*0.05)}}
  addUserKnob {26 ""}
  addUserKnob {7 x1}
  x1 {{pow(2,6*tn_sh+4)}}
  addUserKnob {7 y1 R 1 10}
  y1 {{tn_Lp/100}}
  addUserKnob {7 x0}
  x0 {{0.18+tn_off}}
  addUserKnob {7 y0}
  y0 {{tn_Lg/100*(1+tn_gb*log(y1)/log(2))}}
  addUserKnob {7 s0 R 0 4}
  s0 {{(y0+sqrt(y0*(4*tn_toe+y0)))/2}}
  addUserKnob {7 s10 R 0 4}
  s10 {{x0*(pow(s0,-1/tn_con)-1)}}
  addUserKnob {7 m1 R 0 4}
  m1 {{y1/pow(x1/(x1+s10),tn_con)}}
  addUserKnob {7 m2 R 0 4}
  m2 {{(m1+sqrt(m1*(4*tn_toe+m1)))/2}}
  addUserKnob {7 s R 0 4}
  s {{x0*(pow(s0/m2,-1/tn_con)-1)}}
  addUserKnob {26 ""}
  addUserKnob {7 pt_hdr l "purity hdr"}
  pt_hdr 0.5
  addUserKnob {7 Lf}
  Lf {{pt_hdr*clamp((tn_Lp-100)/900)}}
  addUserKnob {7 s_Lp100 R 0 4}
  s_Lp100 {{x0*(pow((tn_Lg/100),-1/tn_con)-1)}}
  addUserKnob {7 s1 R 0 4}
  s1 {{s*Lf+s_Lp100*(1-Lf)}}
  addUserKnob {26 ""}
  addUserKnob {7 dsc l "display scale" t "final scaling for output display encoding" R 0 4}
  dsc {{eotf==4?0.01:eotf==5?0.1:100/tn_Lp}}
 }
set N85837030 [stack 0]
push $N87c53d0
 MergeExpression {
  inputs 2
  expr0 Ar==0?0:Br/Ar
  expr1 Ag==0?0:Bg/Ag
  expr2 Ab==0?0:Bb/Ab
  name MergeDivideReverse
  xpos 290
  ypos -945
 }
 Dot {
  name Dot2
  xpos 324
  ypos -894
 }
set N48358c00 [stack 0]
 Expression {
  temp_name0 cy
  temp_expr0 r-b
  temp_name1 gm
  temp_expr1 g-(r+b)/2
  temp_name2 c
  temp_expr2 hypot(cy,gm)/2
  temp_name3 h
  temp_expr3 (atan2(cy,gm)+pi+1.10714931)%(2*pi)
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 h
  expr1 cy
  expr2 gm
  expr3 c
  name Opponent
  xpos 70
  ypos -897
 }
 Expression {
  expr3 (1+t0)*(a*a/(a+t0))
  name SmoothCh
  xpos 70
  ypos -873
  addUserKnob {20 Params}
  addUserKnob {7 t0}
  t0 0.25
 }
set N5b63f1e0 [stack 0]
 Dot {
  name Dot8
  xpos -116
  ypos -870
 }
 Expression {
  temp_name0 h0
  temp_expr0 (r-c0+pi)%(2*pi)-pi
  temp_name1 h1
  temp_expr1 (r-c1+pi)%(2*pi)-pi
  temp_name2 h2
  temp_expr2 (r-c2+pi)%(2*pi)-pi
  expr0 exp(-h0*h0/w0)
  expr1 exp(-h1*h1/w1)
  expr2 exp(-h2*h2/w2)
  expr3 a
  name HueRGB
  xpos -150
  ypos -852
  addUserKnob {20 Params}
  addUserKnob {7 c0 R -3 3}
  c0 0.1
  addUserKnob {7 c1 R -3 3}
  c1 4.3
  addUserKnob {7 c2 R -3 3}
  c2 2.3
  addUserKnob {7 w0 R 0 3}
  w0 0.66
  addUserKnob {7 w1 R 0 3}
  w1 0.66
  addUserKnob {7 w2 R 0 3}
  w2 0.66
 }
 Dot {
  name Dot16
  xpos -116
  ypos -828
 }
set Nf14770f0 [stack 0]
push $N85837030
 MergeExpression {
  inputs 2
  temp_name0 tsf
  temp_expr0 (r/(r+1))**(1-p0)
  temp_name1 exf
  temp_expr1 (m+m0*Ar+m1*Ag+m2*Ab)*Aa**(1/w0)
  temp_name3 ex
  temp_expr3 pow(2,exf*(exf<0?tsf:1-tsf))
  channel0 rgb
  expr0 r*ex
  name Brilliance
  xpos -480
  ypos -831
  disable {{!brl_enable}}
  addUserKnob {20 Params}
  addUserKnob {7 m R -6 2}
  addUserKnob {7 m0 R -6 2}
  m0 -3
  addUserKnob {7 m1 R -6 2}
  m1 -3
  addUserKnob {7 m2 R -6 2}
  m2 -3
  addUserKnob {26 ""}
  addUserKnob {7 p0}
  p0 0.5
  addUserKnob {7 w0}
  w0 0.35
 }
 Group {
  name ContrastLow
  label https://www.desmos.com/calculator/blyvi8t2b2
  xpos -480
  ypos -804
  disable {{!tn_lcon_enable}}
  addUserKnob {20 Params}
  addUserKnob {41 tn_lcon l "midtone contrast" T MidtoneContrast.tn_lcon}
  addUserKnob {41 tn_lcon_w l "contrast width" T MidtoneContrast.tn_lcon_w}
  addUserKnob {41 x0 T Normalize.x0}
 }
  Input {
   inputs 0
   name Input
   xpos -590
   ypos -369
  }
  Expression {
   expr0 r*x1
   expr1 g*x1
   expr2 b*x1
   name Normalize
   xpos -590
   ypos -321
   addUserKnob {20 Params}
   addUserKnob {7 m R 0 4}
   m {{parent.MidtoneContrast.m}}
   addUserKnob {7 w}
   w {{parent.MidtoneContrast.w}}
   addUserKnob {7 x0}
   x0 {{parent.parent.TONESCALE_CTRL.x0}}
   addUserKnob {7 p0 R 0 4}
   p0 {{x0*x0-3*m*w}}
   addUserKnob {7 p1 R 0 4}
   p1 {{2*x0*x0+27*w-9*m*w}}
   addUserKnob {7 p2 R 0 4}
   p2 {{pow(sqrt(x0*x0*p1*p1-4*p0*p0*p0)/2+x0*p1/2,1/3)}}
   addUserKnob {7 x1}
   x1 {{((x0*x0-3*m*w)/(3*p2)+p2/3+x0/3)/x0}}
  }
  Expression {
   channel0 rgba
   expr0 r*(r*r+m*w)/(r*r+w)
   name MidtoneContrast
   xpos -590
   ypos -297
   addUserKnob {20 Params}
   addUserKnob {7 tn_lcon R 0 3}
   tn_lcon 2
   addUserKnob {7 tn_lcon_w l "contrast width" R 0 2}
   tn_lcon_w 0.2
   addUserKnob {7 m}
   m {{2**-tn_lcon}}
   addUserKnob {7 w R 0.0001 0.5}
   w {{(tn_lcon_w/4)**2}}
  }
  Output {
   name Output
   xpos -590
   ypos -249
  }
 end_group
 Expression {
  expr0 r<x0?r:invert?r>y1?(r-y1)/k1+x1:pow((r-o)/s0,1/p):r>x1?k1*(r-x1)+y1:s0*r**p+o
  expr1 g<x0?g:invert?g>y1?(g-y1)/k1+x1:pow((g-o)/s0,1/p):g>x1?k1*(g-x1)+y1:s0*g**p+o
  expr2 b<x0?b:invert?b>y1?(b-y1)/k1+x1:pow((b-o)/s0,1/p):b>x1?k1*(b-x1)+y1:s0*b**p+o
  name ContrastHigh
  label https://www.desmos.com/calculator/etjgwyrgad
  xpos -480
  ypos -758
  disable {{!tn_hcon_enable}}
  addUserKnob {20 Params}
  addUserKnob {7 tn_hcon l "Contrast High" R -1 1}
  addUserKnob {7 pv l "contrast high pivot" R 0 4}
  pv 1
  addUserKnob {7 pv_lx l "contrast high lin ext" R 0 4}
  pv_lx 4
  addUserKnob {7 p R 0.1 4}
  p {{2**tn_hcon}}
  addUserKnob {7 x0}
  x0 {{0.18*2**pv}}
  addUserKnob {7 o}
  o {{x0-x0/p}}
  addUserKnob {7 s0}
  s0 {{pow(x0,1-p)/p}}
  addUserKnob {7 x1}
  x1 {{x0*2**pv_lx}}
  addUserKnob {7 k1}
  k1 {{p*s0*x1**p/x1}}
  addUserKnob {7 y1}
  y1 {{s0*x1**p+o}}
  addUserKnob {6 invert +STARTLINE}
 }
 Expression {
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 pow(r/(r+s),p)
  expr1 pow(r/(r+s1),p)
  expr2 pow(r/(r+s_Lp100),p)
  name MMGreyPowerSigmoid
  label https://www.desmos.com/calculator/ofwtcmzc3w
  xpos -480
  ypos -709
  addUserKnob {20 Params}
  addUserKnob {7 p R 1 4}
  p {{parent.TONESCALE_CTRL.p}}
  addUserKnob {7 s R 0 4}
  s {{parent.TONESCALE_CTRL.s}}
  addUserKnob {7 s1 R 0 4}
  s1 {{parent.TONESCALE_CTRL.s1}}
  addUserKnob {7 s_Lp100 R 0 4}
  s_Lp100 {{parent.TONESCALE_CTRL.s_Lp100}}
 }
 Dot {
  name Dot1
  xpos -446
  ypos -654
 }
set N9b292b60 [stack 0]
 Expression {
  channel0 rgb
  expr0 r*m
  name Scale
  xpos -480
  ypos -249
  addUserKnob {20 Params}
  addUserKnob {7 m R 0 4}
  m {{parent.TONESCALE_CTRL.m2}}
 }
 Expression {
  channel0 rgba
  expr0 r*r/(r+toe)
  name ToeCompressQuadratic
  label https://www.desmos.com/calculator/skk8ahmnws
  xpos -480
  ypos -231
  addUserKnob {20 Params}
  addUserKnob {7 toe R 0 0.1}
  toe {{parent.TONESCALE_CTRL.tn_toe}}
 }
 Expression {
  channel0 rgb
  expr0 r*m
  name Normalize
  xpos -480
  ypos -201
  addUserKnob {20 Params}
  addUserKnob {7 m R 0 4}
  m {{parent.TONESCALE_CTRL.dsc}}
 }
 Dot {
  name Dot411
  xpos -446
  ypos -174
 }
push $N9b292b60
push $Nf14770f0
 Dot {
  name Dot3
  xpos -116
  ypos -534
 }
set Ndd78820 [stack 0]
 Dot {
  name Dot7
  xpos -116
  ypos -438
 }
set N66c71a0 [stack 0]
 Premult {
  name Premult1
  xpos -150
  ypos -346
 }
set N3051dfa0 [stack 0]
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.alpha
  name Copy3
  xpos 180
  ypos -262
 }
push $N9b292b60
 Dot {
  name Dot6
  xpos -336
  ypos -654
 }
set N7b37fa00 [stack 0]
 Expression {
  channel0 rgba
  expr0 b
  name Expression2
  tile_color 0x8e00
  xpos -260
  ypos -658
 }
set N5c045820 [stack 0]
 Dot {
  name Dot17
  tile_color 0x666666ff
  xpos -226
  ypos -294
 }
push $N3051dfa0
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.alpha
  name Copy6
  xpos -150
  ypos -303
 }
 Dot {
  name Dot11
  xpos 214
  ypos -294
 }
push $N5c045820
 Dot {
  name Dot4
  xpos -6
  ypos -654
 }
set Nf1ddb70 [stack 0]
push $N66c71a0
 MergeExpression {
  inputs 2
  temp_name0 f0
  temp_expr0 1+s0*exp(-2*a*a/w0)*(1-Ar)**(1/p0)
  temp_name1 f1
  temp_expr1 1+s1*exp(-2*a*a/w1)*Ar**(1/(4*p1))
  channel0 rgb
  expr0 f0*f1
  name MidPurity
  xpos -40
  ypos -441
  addUserKnob {20 Params}
  addUserKnob {7 s0}
  s0 0.8
  addUserKnob {7 p0}
  p0 0.4
  addUserKnob {7 w0 R 0.1 1}
  w0 0.5
  addUserKnob {7 s1 R -0.9 0}
  s1 -0.7
  addUserKnob {7 p1}
  p1 0.66
  addUserKnob {7 w1 R 0.1 1}
  w1 0.6
 }
push $Ndd78820
push $N5b63f1e0
 Dot {
  name Dot12
  xpos 104
  ypos -643
 }
set N2fd1b7d0 [stack 0]
 Expression {
  temp_name0 h0
  temp_expr0 (r-c0+pi)%(2*pi)-pi
  temp_name1 h1
  temp_expr1 (r-c1+pi)%(2*pi)-pi
  temp_name2 h2
  temp_expr2 (r-c2+pi)%(2*pi)-pi
  expr0 exp(-h0*h0/w0)
  expr1 exp(-h1*h1/w1)
  expr2 exp(-h2*h2/w2)
  expr3 a
  name HueOGB
  xpos 180
  ypos -630
  addUserKnob {20 Params}
  addUserKnob {7 c0 R -3 3}
  c0 -0.4
  addUserKnob {7 c1 R -3 3}
  c1 4.3
  addUserKnob {7 c2 R -3 3}
  c2 2.5
  addUserKnob {7 w0 R 0 3}
  w0 0.66
  addUserKnob {7 w1 R 0 3}
  w1 0.66
  addUserKnob {7 w2 R 0 3}
  w2 0.66
 }
set Ne4794d0 [stack 0]
push $N7b37fa00
 Expression {
  channel0 rgba
  expr0 g
  name Expression1
  tile_color 0x7a0000
  xpos -370
  ypos -636
 }
set N238940 [stack 0]
 MergeExpression {
  inputs 2
  temp_name0 _p
  temp_expr0 1+4*(1-r)*(p+p0*Ar+p1*Ag+p2*Ab)
  channel0 {rgba.red rgba.green rgba.blue none}
  expr0 1-r**_p
  name PurityLimitLow
  label https://www.desmos.com/calculator/adtzkjofgn
  xpos -370
  ypos -597
  addUserKnob {20 Params}
  addUserKnob {7 p}
  p 0.25
  addUserKnob {7 p0}
  p0 0.25
  addUserKnob {7 p1}
  addUserKnob {7 p2}
  p2 0.1
 }
 MergeExpression {
  inputs 2
  temp_name0 _p
  temp_expr0 (1-Aa*(p0*Ar+p1*Ab))*(1-p*Aa)
  channel0 {rgba.red rgba.green rgba.blue -rgba.alpha}
  expr0 r**(_p)
  name PurityLimitHigh
  xpos -370
  ypos -537
  addUserKnob {20 Params}
  addUserKnob {7 p}
  p 0.15
  addUserKnob {7 p0}
  p0 0.15
  addUserKnob {7 p1}
 }
 Fill {
  name Fill1
  xpos -370
  ypos -489
  disable {{pt_enable}}
 }
 Dot {
  name Dot5
  xpos -336
  ypos -390
 }
 MergeExpression {
  inputs 2
  temp_name0 m
  temp_expr0 Ar
  expr0 m*r
  expr1 m*g
  expr2 m*b
  name MultiplyMP
  xpos -40
  ypos -393
  disable {{!ptm_enable}}
 }
push $N238940
 Dot {
  name Dot13
  xpos 104
  ypos -560
 }
set N13296100 [stack 0]
 Invert {
  channels rgba
  name Invert1
  xpos 70
  ypos -442
 }
push $N2fd1b7d0
 Expression {
  temp_name0 h0
  temp_expr0 (r-c0+pi)%(2*pi)-pi
  temp_name1 h1
  temp_expr1 (r-c1+pi)%(2*pi)-pi
  temp_name2 h2
  temp_expr2 (r-c2+pi)%(2*pi)-pi
  expr0 exp(-h0*h0/w0)
  expr1 exp(-h1*h1/w1)
  expr2 exp(-h2*h2/w2)
  expr3 a
  name HueCMY
  xpos 180
  ypos -514
  addUserKnob {20 Params}
  addUserKnob {7 c0 R -3 3}
  c0 3.3
  addUserKnob {7 c1 R -3 3}
  c1 1.5
  addUserKnob {7 c2 R -3 3}
  c2 -1.15
  addUserKnob {7 w0 R 0 3}
  w0 0.5
  addUserKnob {7 w1 R 0 3}
  w1 0.5
  addUserKnob {7 w2 R 0 3}
  w2 0.5
 }
 Expression {
  expr0 r*a**(1/p0)
  expr1 g*a**(1/p1)
  expr2 b*a**(1/p2)
  name PremultPower
  xpos 180
  ypos -490
  addUserKnob {20 Params}
  addUserKnob {7 p0}
  p0 1
  addUserKnob {7 p1}
  p1 1
  addUserKnob {7 p2}
  p2 1
 }
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.alpha
  name Copy2
  xpos 180
  ypos -447
 }
push $N13296100
push $Ne4794d0
 Expression {
  expr0 r*a**p0
  expr1 g*a**p1
  expr2 b*a**p2
  name PremultPower1
  xpos 180
  ypos -609
  addUserKnob {20 Params}
  addUserKnob {7 p0}
  p0 1
  addUserKnob {7 p1}
  p1 1
  addUserKnob {7 p2}
  p2 1
 }
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.alpha
  name Copy1
  xpos 180
  ypos -569
 }
push $Nf1ddb70
push $Nf14770f0
 MergeExpression {
  inputs 2
  temp_name0 ts
  temp_expr0 1-Ar
  temp_name1 c
  temp_expr1 ts*(1-a)+a*(1-ts)
  expr0 Br*c*a
  expr1 0
  expr2 0
  expr3 ts**(1/p)
  name HueContrastStrength
  xpos 180
  ypos -657
  addUserKnob {20 Params}
  addUserKnob {7 p}
  p 0.3
 }
push $N48358c00
 MergeExpression {
  inputs 2
  temp_name0 f0
  temp_expr0 m0*(Ar-2*Ar*Aa)+1
  expr0 r
  expr1 g*f0
  expr2 b*f0
  maskChannelMask rgba.red
  invert_mask true
  name HueContrastR
  xpos 290
  ypos -657
  disable {{!hc_enable}}
  addUserKnob {20 Params}
  addUserKnob {7 m0 l "Hue Contrast R" R 0 2}
  m0 1
 }
 MergeExpression {
  inputs 2
  temp_name0 f0
  temp_expr0 m0*Ar*Aa**(1/p0)
  temp_name1 f1
  temp_expr1 -m1*Ag*Aa**(1/p1)
  temp_name2 f2
  temp_expr2 -m2*Ab*Aa**(1/p2)
  expr0 r+f2-f1
  expr1 g+f0-f2
  expr2 b+f1-f0
  name HueShiftOGB
  xpos 290
  ypos -563
  disable {{!hs_rgb_enable}}
  addUserKnob {20 Params}
  addUserKnob {7 m0}
  m0 0.6
  addUserKnob {7 p0 R 0 2}
  p0 0.9
  addUserKnob {7 m1}
  m1 0.35
  addUserKnob {7 p1 R 0 2}
  p1 1
  addUserKnob {7 m2}
  m2 0.66
  addUserKnob {7 p2 R 0 2}
  p2 1
 }
 MergeExpression {
  inputs 2
  temp_name0 f0
  temp_expr0 -m0*Ar*Aa**(1/p0)
  temp_name1 f1
  temp_expr1 m1*Ag*Aa**(1/p1)
  temp_name2 f2
  temp_expr2 m2*Ab*Aa**(1/p2)
  expr0 r+f2-f1
  expr1 g+f0-f2
  expr2 b+f1-f0
  name HueShiftCMY
  xpos 290
  ypos -441
  disable {{!hs_cmy_enable}}
  addUserKnob {20 Params}
  addUserKnob {7 m0}
  addUserKnob {7 p0}
  p0 1
  addUserKnob {7 m1}
  addUserKnob {7 p1}
  p1 1
  addUserKnob {7 m2}
  addUserKnob {7 p2}
  p2 0.5
 }
 MergeExpression {
  inputs 2
  temp_name0 f
  temp_expr0 Ar
  expr0 r*f+1-f
  expr1 g*f+1-f
  expr2 b*f+1-f
  name LerpToOne
  xpos 290
  ypos -393
 }
 Expression {
  temp_name3 L
  temp_expr3 r*rw+g*gw+b*bw
  expr0 invert?(L*s-r)/(s-1):L*(1-s)+r*s
  expr1 invert?(L*s-g)/(s-1):L*(1-s)+g*s
  expr2 invert?(L*s-b)/(s-1):L*(1-s)+b*s
  name SatWInverse
  xpos 290
  ypos -348
  addUserKnob {20 Params}
  addUserKnob {7 s}
  s {{parent.SatW.s}}
  addUserKnob {7 rw}
  rw {{parent.SatW.rw}}
  addUserKnob {7 gw}
  gw {{1-(rw+bw)}}
  addUserKnob {7 bw}
  bw {{parent.SatW.bw}}
  addUserKnob {6 invert +STARTLINE}
  invert true
 }
 Group {
  inputs 2
  name DisplayGamut
  tile_color 0xc58930ff
  xpos 290
  ypos -302
  mapsize {0 0.0005701254276}
  addUserKnob {20 Params}
  addUserKnob {4 cwp l "creative white" M {D93 D75 D65 D60 D55 D50 ""}}
  cwp D65
  addUserKnob {41 p l range T Range.p}
  addUserKnob {4 gamut l "display gamut" t "Choose the target display device chromaticities." M {Rec.709 P3-D65 "Rec.2020 (P3 Limited)" P3-D60 P3-DCI X'Y'Z'}}
 }
  Input {
   inputs 0
   name InputTS
   xpos -40
   ypos -850
   number 1
  }
  Expression {
   channel0 rgba
   expr0 a**(2*p)
   name Range
   xpos -40
   ypos -801
   addUserKnob {20 Params}
   addUserKnob {7 p}
   p 0.25
  }
  Dot {
   name Dot3
   tile_color 0x666666ff
   xpos -6
   ypos -777
  }
set N1202b4b0 [stack 0]
push $N1202b4b0
  Dot {
   name Dot5
   tile_color 0x666666ff
   xpos 1754
   ypos -798
  }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -1161
  }
add_layer {white white.red white.green white.blue}
  AddChannels {
   channels white
   color 1
   name AddChannels1
   xpos 400
   ypos -1120
  }
  ColorMatrix {
   channels all
   matrix {
        {0.4865709486 0.2656676932 0.1982172852}
        {0.2289745641 0.6917385218 0.07928691409}
        {-3.972075517e-17 0.04511338186 1.043944369}
   }
   name ColorMatrix51
   label "P3 to XYZ"
   xpos 400
   ypos -1053
  }
  Dot {
   name Dot1
   tile_color 0x666666ff
   xpos 434
   ypos -966
  }
set N86932730 [stack 0]
  Dot {
   name Dot173
   tile_color 0x666666ff
   xpos 1204
   ypos -966
  }
set N26d1fc70 [stack 0]
  Dot {
   name Dot2
   tile_color 0x666666ff
   xpos 1974
   ypos -966
  }
set N26d26350 [stack 0]
  ColorMatrix {
   channels all
   matrix {
        {1.009516001 0.02696754411 0.02136208117}
        {0.0187991038 0.9753303528 0.008227333426}
        {0.0001345432829 0.002179034986 1.13866365}
   }
   name ColorMatrix22
   label "DCI-P3 to D65 cat02"
   xpos 1940
   ypos -886
  }
set N6442c280 [stack 0]
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.alpha
   name Copy3
   xpos 1720
   ypos -780
  }
push $N1202b4b0
push $N86932730
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.alpha
   name Copy2
   xpos 146
   ypos -705
  }
  Switch {
   inputs 2
   which {{gamut<4?0:1}}
   name SwitchDCIWhite1
   xpos 146
   ypos -643
  }
push $N26d26350
  ColorMatrix {
   channels all
   matrix {
        {1.053068757 0.05812973157 -0.03761008382}
        {0.04123594239 0.9776936769 -0.01527922228}
        {-0.001137776766 -0.001707592979 0.8673683405}
   }
   name ColorMatrix16
   label "DCI-P3 to D50 cat02"
   xpos 2270
   ypos -885
  }
push $N26d26350
  ColorMatrix {
   channels all
   matrix {
        {1.035945773 0.04509375617 -0.01575738192}
        {0.03187406808 0.9777445197 -0.006557449698}
        {-0.0006536094006 -0.0002973722294 0.9663277864}
   }
   name ColorMatrix52
   label "DCI-P3 to D55 cat02"
   xpos 2160
   ypos -885
  }
push $N26d26350
  ColorMatrix {
   channels all
   matrix {
        {1.02159524 0.03484867886 0.003712520003}
        {0.02449687757 0.9769372344 0.001203015447}
        {-0.0002339158673 0.000986687839 1.055942655}
   }
   name ColorMatrix23
   label "DCI-P3 to D60 cat02"
   xpos 2050
   ypos -885
  }
push $N6442c280
push $N26d26350
  ColorMatrix {
   channels all
   matrix {
        {0.9901207685 0.0151389474 0.05110476911}
        {0.01021972112 0.9717181325 0.02005366236}
        {0.0007430727128 0.004217634909 1.279596567}
   }
   name ColorMatrix78
   label "DCI-P3 to D75 cat02"
   xpos 1830
   ypos -888
  }
push $N26d26350
  ColorMatrix {
   channels all
   matrix {
        {0.96568501 0.001837452408 0.09129673243}
        {0.000514572137 0.9651667476 0.03601465374}
        {0.001542504877 0.007026517764 1.472874761}
   }
   name ColorMatrix79
   label "DCI-P3 to D93 cat02"
   xpos 1720
   ypos -888
  }
  Switch {
   inputs 6
   which {{cwp}}
   name SwitchCWP3
   xpos 1940
   ypos -752
  }
push $N26d1fc70
  ColorMatrix {
   channels all
   matrix {
        {1.030252695 0.02279104665 -0.03926569223}
        {0.0163766481 1.000205994 -0.01566682383}
        {-0.0008645767812 -0.002546684816 0.8214220405}
   }
   name ColorMatrix58
   label "D60 to D50 cat02"
   xpos 1500
   ypos -885
  }
push $N26d1fc70
  ColorMatrix {
   channels all
   matrix {
        {1.013802886 0.01001315098 -0.01849834621}
        {0.007205651607 1.000576854 -0.007375299931}
        {-0.0004011336714 -0.001214349642 0.9151356816}
   }
   name ColorMatrix56
   label "D60 to D55 cat02"
   xpos 1390
   ypos -885
  }
push $N26d1fc70
  Dot {
   name Dot172
   tile_color 0x666666ff
   xpos 1314
   ypos -870
  }
push $N26d1fc70
  ColorMatrix {
   channels all
   matrix {
        {0.9883639216 -0.007669100538 0.01676416397}
        {-0.005540961865 0.9985461235 0.006673321128}
        {0.000351537019 0.001128837466 1.078335762}
   }
   name ColorMatrix57
   label "D60 to D65 cat02"
   xpos 1170
   ypos -885
  }
push $N26d1fc70
  ColorMatrix {
   channels all
   matrix {
        {0.9696599841 -0.01913831197 0.04500995576}
        {-0.01385457721 0.9951338172 0.01790622622}
        {0.0009314522613 0.003060081974 1.211798072}
   }
   name ColorMatrix77
   label "D60 to D75 cat02"
   xpos 1060
   ypos -888
  }
push $N26d1fc70
  ColorMatrix {
   channels all
   matrix {
        {0.9460569024 -0.03195030242 0.08317014575}
        {-0.02319796942 0.9887458086 0.03306175023}
        {0.001692034304 0.005723287351 1.394831061}
   }
   name ColorMatrix76
   label "D60 to D93 cat02"
   xpos 950
   ypos -888
  }
  Switch {
   inputs 6
   which {{cwp}}
   name SwitchCWP1
   xpos 1170
   ypos -753
  }
push $N86932730
  ColorMatrix {
   channels all
   matrix {
        {1.042574048 0.03089117631 -0.052812621}
        {0.02219353616 1.001856685 -0.02107376233}
        {-0.001164883142 -0.003420527093 0.7617890835}
   }
   name ColorMatrix53
   label "D65 to D50 cat02"
   xpos 730
   ypos -885
  }
push $N86932730
  ColorMatrix {
   channels all
   matrix {
        {1.025850892 0.01794398203 -0.03321377933}
        {0.01291338541 1.002147794 -0.01324210316}
        {-0.0007199402899 -0.002181068063 0.8486801386}
   }
   name ColorMatrix15
   label "D65 to D55 cat02"
   xpos 620
   ypos -885
  }
push $N86932730
  ColorMatrix {
   channels all
   matrix {
        {1.011822462 0.007788793184 -0.01577830315}
        {0.005616828334 1.001506448 -0.006285175681}
        {-0.0003357357346 -0.001050950028 0.9273666739}
   }
   name ColorMatrix10
   label "D65 to D60 cat02"
   xpos 510
   ypos -886
  }
push $N86932730
push $N86932730
  ColorMatrix {
   channels all
   matrix {
        {0.9810010791 -0.01166192535 0.02656140924}
        {-0.008434880525 0.9965060949 0.01056965441}
        {0.0005528095644 0.001798408106 1.12374723}
   }
   name ColorMatrix74
   label "D65 to D75 cat02"
   xpos 290
   ypos -888
  }
push $N86932730
  ColorMatrix {
   channels all
   matrix {
        {0.9570342302 -0.02471715026 0.06240285933}
        {-0.01792969555 0.9900198579 0.02481195331}
        {0.001275891438 0.004279190674 1.29345715}
   }
   name ColorMatrix75
   label "D65 to D93 cat02"
   xpos 180
   ypos -888
  }
  Switch {
   inputs 6
   which {{cwp}}
   name SwitchCWP2
   xpos 400
   ypos -752
  }
  Switch {
   inputs 3
   which {{gamut<3?0:gamut==3?1:2}}
   name SwitchWhitepoints
   xpos 400
   ypos -633
  }
  MergeExpression {
   inputs 2
   expr0 Br*Aa+Ar*(1-Aa)
   expr1 Bg*Aa+Ag*(1-Aa)
   expr2 Bb*Aa+Ab*(1-Aa)
   name MergeExpression2
   label Mix
   xpos 400
   ypos -556
  }
  Dot {
   name Dot10
   tile_color 0x666666ff
   xpos 434
   ypos -462
  }
set N5943bc70 [stack 0]
  Dot {
   name Dot6
   tile_color 0x666666ff
   xpos 544
   ypos -462
  }
set N59441eb0 [stack 0]
  Dot {
   name Dot9
   tile_color 0x666666ff
   xpos 654
   ypos -462
  }
  ColorMatrix {
   channels all
   matrix {
        {0.9910855889 -0.02736228704 -0.01839566231}
        {-0.01910219155 1.025837779 -0.007053725421}
        {-8.055032231e-05 -0.001959888265 0.8782384396}
   }
   name ColorMatrix1
   label "D65 to DCI-P3 cat02"
   xpos 620
   ypos -435
  }
  Multiply {
   channels rgb
   value {{48/52.37}}
   name DCDM_Normalize
   label "disabled if \ncwp cooler than D65"
   xpos 620
   ypos -373
   disable {{parent.cwp<2}}
  }
push $N59441eb0
  ColorMatrix {
   channels all
   matrix {
        {2.493496912 -0.9313836179 -0.4027107845}
        {-0.8294889696 1.76266406 0.02362468584}
        {0.03584583024 -0.07617238927 0.956884524}
   }
   name ColorMatrix48
   label "XYZ to P3"
   xpos 510
   ypos -428
  }
  Switch {
   inputs 2
   which {{parent.gamut==5}}
   name SwitchDCDM
   xpos 510
   ypos -321
  }
push $N5943bc70
  ColorMatrix {
   channels all
   matrix {
        {3.240969942 -1.537383178 -0.4986107603}
        {-0.9692436363 1.875967502 0.04155505741}
        {0.0556300797 -0.2039769589 1.056971514}
   }
   name ColorMatrix45
   label "XYZ to Rec709"
   xpos 400
   ypos -430
  }
  Switch {
   inputs 2
   which {{gamut}}
   name SwitchGamut3
   xpos 400
   ypos -321
  }
  Dot {
   name Dot7
   tile_color 0x666666ff
   xpos 434
   ypos -258
  }
set N57031f20 [stack 0]
  Shuffle {
   in white
   name Shuffle9
   xpos 193
   ypos -261
  }
  Expression {
   channel0 rgba
   expr0 1/max(r,g,b)
   name Max
   xpos 193
   ypos -237
  }
  MergeExpression {
   inputs 2
   temp_name0 m
   temp_expr0 r
   channel0 {rgba.red rgba.green rgba.blue none}
   expr0 m*Aa+1-Aa
   name MergeExpression1
   xpos 193
   ypos -174
  }
push $N57031f20
  Merge2 {
   inputs 2
   operation multiply
   bbox B
   name Merge2
   label "disabled for DCDM, \nif cwp D65 or warmer"
   xpos 398
   ypos -188
   disable {{parent.gamut==5&&parent.cwp>1}}
  }
  Output {
   name Output
   xpos 398
   ypos 22
  }
 end_group
 MergeExpression {
  inputs 2
  temp_name0 c0
  temp_expr0 hypot(r-b,g-(r+b)/2)/4
  temp_name1 c
  temp_expr1 (1+0.1)*(c0*c0/(c0+0.1))
  temp_name2 _m
  temp_expr2 m+m0*Ar+m1*Ag+m2*Ab
  temp_name3 ex
  temp_expr3 pow(2,_m*c*Aa)
  expr0 r*ex
  expr1 g*ex
  expr2 b*ex
  name BrilliancePost
  xpos 290
  ypos -256
  disable {{!brlp_enable}}
  addUserKnob {20 Params}
  addUserKnob {7 m R -1 0}
  addUserKnob {7 m0 R -3 0}
  m0 -1.7
  addUserKnob {7 m1 R -3 0}
  m1 -2
  addUserKnob {7 m2 R -3 0}
  m2 -0.5
 }
 Expression {
  expr0 s0<1e-4?r:r>10*s0?r:s0*log(1+exp(r/s0))
  expr1 s1<1e-4?g:g>10*s1?g:s1*log(1+exp(g/s1))
  expr2 s2<1e-4?b:b>10*s2?b:s2*log(1+exp(b/s2))
  name SoftplusRGB
  label https://www.desmos.com/calculator/5csxsqdgcc
  xpos 290
  ypos -223
  disable {{!ptl_enable}}
  addUserKnob {20 Params}
  addUserKnob {7 s0 R 0 0.25}
  s0 0.05
  addUserKnob {7 s1 R 0 0.25}
  s1 0.08
  addUserKnob {7 s2 R 0 0.25}
  s2 0.05
 }
 MergeExpression {
  inputs 2
  temp_name0 m
  temp_expr0 Ar
  expr0 m*r
  expr1 m*g
  expr2 m*b
  expr3 1
  name Multiply
  xpos 290
  ypos -177
 }
 Dot {
  name Dot9
  tile_color 0x666666ff
  xpos 324
  ypos -102
 }
set N4b522fb0 [stack 0]
 Clamp {
  channels rgb
  maximum_enable false
  name ClampMin2
  xpos 400
  ypos -105
 }
 ColorMatrix {
  matrix {
       {0.7538330344 0.1985973691 0.04756959659}
       {0.04574384897 0.9417772198 0.01247893122}
       {-0.001210340355 0.0176017173 0.9836086231}
  }
  name ColorMatrix37
  label "P3D65 to Rec2020"
  xpos 400
  ypos -87
 }
push $N4b522fb0
 Switch {
  inputs 2
  which {{parent.DisplayGamut.gamut==2}}
  name SwitchGamutRec2020
  xpos 290
  ypos -81
 }
 Clamp {
  channels rgb
  name Clamp
  xpos 290
  ypos -33
  disable {{!parent.clamp}}
 }
 Group {
  name InverseEOTF
  xpos 290
  ypos 10
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf t "Choose the inverse EOTF to apply for the target display device." M {Linear "2.2 Power - sRGB Display" "2.4 Power - Rec.1886" "2.6 Power DCI" PQ HLG "" "" "" ""}}
  eotf "2.4 Power - Rec.1886"
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -129
  }
set N46424f60 [stack 0]
  Expression {
   temp_name0 Yd
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   temp_name1 p
   temp_expr1 1.2
   expr0 r*pow(Yd,(1-p)/p)
   expr1 g*pow(Yd,(1-p)/p)
   expr2 b*pow(Yd,(1-p)/p)
   mix 0.205
   name HLG_InverseOOTF
   label "1000 nits"
   xpos 620
   ypos -58
  }
  Expression {
   expr0 r<=1/12?sqrt(3*r):_a*log(12*r-_b)+_c
   expr1 g<=1/12?sqrt(3*g):_a*log(12*g-_b)+_c
   expr2 b<=1/12?sqrt(3*b):_a*log(12*b-_b)+_c
   name HLG_OETF
   xpos 620
   ypos -11
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
push $N46424f60
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,m_1)
   temp_name1 gp
   temp_expr1 pow(g,m_1)
   temp_name2 bp
   temp_expr2 pow(b,m_1)
   expr0 pow((c_1+c_2*rp)/(1+c_3*rp),m_2)
   expr1 pow((c_1+c_2*gp)/(1+c_3*gp),m_2)
   expr2 pow((c_1+c_2*bp)/(1+c_3*bp),m_2)
   name ST2084_InverseEOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N46424f60
  Expression {
   expr0 sign(r)*pow(fabs(r),1/p)
   expr1 sign(g)*pow(fabs(g),1/p)
   expr2 sign(b)*pow(fabs(b),1/p)
   name Power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos 14
  }
  Output {
   name Output
   xpos 400
   ypos 86
  }
 end_group
 Output {
  name Output
  xpos 290
  ypos 63
 }
end_group
